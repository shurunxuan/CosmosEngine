# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- master

strategy:
  matrix:
    linux:
      imageName: "ubuntu-16.04"
    mac:
      imageName: "macos-10.13"
    windows:
      imageName: "windows-2019"
  maxParallel: 3

pool:
  vmImage: $(imageName)

steps:

  - bash: sudo apt install build-essential libevent-pthreads-2.0.5 doxygen xorg-dev libglu1-mesa-dev libglm-dev
    condition: eq(variables['Agent.OS'], 'Linux')
    displayName: 'Install build dependencies (Linux)'

  - bash: |
      git clone https://github.com/glfw/glfw.git
      cd glfw
      cmake .
      make
      sudo make install
      cd ..
    condition: eq(variables['Agent.OS'], 'Linux')
    displayName: 'Build GLFW from source'

  - bash: brew install glfw glm --HEAD
    condition: eq(variables['Agent.OS'], 'Darwin')
    displayName: 'Install build dependencies (macOS)'

  - powershell: |
      vcpkg update
      vcpkg upgrade --no-dry-run
      vcpkg install glfw3:x64-windows glm:x64-windows
    condition: eq(variables['Agent.OS'], 'Windows_NT')
    displayName: 'Install build dependencies (Windows)'
